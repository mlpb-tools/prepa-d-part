<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Préparation au Départ - E-learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        .module-card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
        }
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .module-header {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .module-icon {
            flex-shrink: 0;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
        }
        .module-content {
            padding: 0 1.5rem 1.5rem 1.5rem;
            display: none;
        }
        .activity-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .activity-item:hover {
            background-color: #eef2ff;
            border-color: #c7d2fe;
        }
        .activity-item svg {
            color: #475569;
            margin-right: 0.75rem;
        }
        .progress-bar-bg {
            background-color: #e2e8f0;
            border-radius: 9999px;
        }
        .progress-bar-fg {
            background-color: #3b82f6;
            transition: width 0.5s ease-in-out;
        }
        .module-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .tag-essential { background-color: #fecaca; color: #b91c1c; }
        .tag-pratique { background-color: #bfdbfe; color: #1e40af; }
        .tag-perso { background-color: #d1fae5; color: #065f46; }
        .tag-avenir { background-color: #fed7aa; color: #9a3412; }
        
        .module-card.completed .module-header {
             background-color: #f0fdf4;
        }
        .module-card.completed .module-icon {
            background-color: #22c55e !important;
            color: white !important;
        }

        /* Modal styles */
        #activity-modal-content { max-height: 90vh; }
        .quiz-option {
            display: block;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .quiz-option:hover { background-color: #f3f4f6; }
        .quiz-option input { display: none; }
        .quiz-option.selected {
            background-color: #e0e7ff;
            border-color: #4f46e5;
            font-weight: 600;
        }
        .quiz-option.correct { background-color: #dcfce7; border-color: #22c55e; }
        .quiz-option.incorrect { background-color: #fee2e2; border-color: #ef4444; }

        /* Drag and Drop styles */
        .drop-zone { min-height: 50px; border: 2px dashed #d1d5db; transition: background-color 0.2s; }
        .drop-zone.drag-over { background-color: #e0e7ff; }
        .draggable { cursor: grab; }
        .draggable:active { cursor: grabbing; }

    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-2">Ta Prépa Mobilité</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">Le parcours interactif pour réussir ton départ et ton expérience à l'étranger.</p>
        </header>

        <div class="mb-8 p-4 bg-white rounded-lg shadow-sm">
            <div class="flex justify-between items-center mb-2">
                <h2 class="font-bold text-lg">Ta progression</h2>
                <span id="progress-text" class="font-bold text-blue-600">0%</span>
            </div>
            <div class="progress-bar-bg w-full h-4 overflow-hidden">
                <div id="progress-bar" class="progress-bar-fg h-4" style="width: 0%;"></div>
            </div>
        </div>

        <div id="modules-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Les modules seront injectés ici par JavaScript -->
        </div>
    </div>

    <!-- Modal pour les activités -->
    <div id="activity-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden p-4">
        <div id="activity-modal-content" class="bg-white rounded-lg shadow-xl max-w-2xl w-full transform transition-all scale-95 opacity-0 overflow-y-auto">
            <!-- Le contenu de l'activité sera injecté ici -->
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA ---
        const modulesData = [
            {
                id: 1,
                title: "Explore ta mobilité (Stage, Volontariat, Échange...)",
                icon: "compass",
                color: "#fefce8",
                iconColor: "#ca8a04",
                tag: { text: "Le Départ", class: "tag-essential" },
                activities: [
                    { id: "m1_intro", type: "Quiz", title: "Quel type de mobilité est fait pour toi ?", icon: "help-circle" },
                    { id: "coming_soon", type: "Vidéo", title: "Témoignages : ils l'ont fait !", icon: "play-circle" },
                    { id: "coming_soon", type: "Carte interactive", title: "Découvre des projets et opportunités", icon: "map" }
                ]
            },
            {
                id: 2,
                title: "Mon Statut, mes Droits & Devoirs",
                icon: "briefcase",
                color: "#f0f9ff",
                iconColor: "#0284c7",
                tag: { text: "Le Cadre", class: "tag-essential" },
                activities: [
                    { id: "m2_intro", type: "Quiz", title: "Vrai ou Faux : Statuts & Aides", icon: "help-circle" },
                    { id: "m2_drag_drop", type: "Jeu interactif", title: "Associe le statut à ses caractéristiques", icon: "mouse-pointer-2" },
                    { id: "m2_qui_contacter", type: "Jeu interactif", title: "Qui contacter en cas de problème ?", icon: "phone-forwarded" },
                    { id: "m2_checklist", type: "Checklist", title: "Mes devoirs et responsabilités", icon: "check-square" }
                ]
            },
             {
                id: 3,
                title: "Sensibilisation interculturelle",
                icon: "globe-2",
                color: "#fff7ed",
                iconColor: "#f97316",
                tag: { text: "La Découverte", class: "tag-perso" },
                activities: [
                    { id: "m3_intro", type: "Sondage", title: "Comment te sens-tu à l'idée de partir ?", icon: "bar-chart-2" },
                    { id: "m3_choc", type: "Simulateur", title: "Le choc culturel : comment réagir ?", icon: "message-square" },
                    { id: "m3_stereotypes", type: "Quiz", title: "Vrai ou Faux : les stéréotypes", icon: "help-circle" },
                    { id: "m3_cles", type: "Auto-évaluation", title: "Mes clés pour réussir", icon: "key-round" }
                ]
            },
            {
                id: 4,
                title: "Santé et sécurité",
                icon: "heart-pulse",
                color: "#fef2f2",
                iconColor: "#dc2626",
                tag: { text: "L'essentiel", class: "tag-essential" },
                activities: [
                    { id: "m4_intro", type: "Question flash", title: "Serais-tu prêt en cas de pépin ?", icon: "siren" },
                    { id: "m4_trousse", type: "Checklist interactive", title: "Ma trousse de secours perso", icon: "clipboard-list" },
                    { id: "m4_assurance", type: "QCM", title: "Comprendre ton assurance", icon: "file-text" },
                    { id: "m4_urgence", type: "Jeu", title: "Qui appeler en cas d'urgence ?", icon: "phone-call" }
                ]
            },
            {
                id: 5,
                title: "La Paperasse : Documents & Démarches",
                icon: "folder-kanban",
                color: "#f5f3ff",
                iconColor: "#7c3aed",
                tag: { text: "L'essentiel", class: "tag-essential" },
                activities: [
                    { id: "m5_intro", type: "Question flash", title: "Tes papiers sont-ils à jour ?", icon: "file-check-2" },
                    { id: "m5_documents", type: "Checklist interactive", title: "Checklist des documents de voyage", icon: "check-square" },
                    { id: "m5_cej", type: "Cas pratique", title: "Garder le lien avec ton conseiller", icon: "user-check" },
                    { id: "m5_assurance_docs", type: "QCM", title: "Les documents d'assurance", icon: "shield-check" }
                ]
            },
            {
                id: 6,
                title: "Soutien linguistique (OLS)",
                icon: "languages",
                color: "#f0fdfa",
                iconColor: "#0d9488",
                tag: { text: "La Pratique", class: "tag-pratique" },
                activities: [
                    { id: "m6_intro", type: "Sondage", title: "Comment te sens-tu avec les langues ?", icon: "message-circle" },
                    { id: "m6_tuto", type: "Tutoriel interactif", title: "Comment s'inscrire à OLS ?", icon: "book-open" },
                    { id: "m6_defi", type: "Défi", title: "Apprends 10 phrases clés", icon: "swords" },
                    { id: "m6_cles", type: "Auto-évaluation", title: "Mes clés linguistiques", icon: "key-round" }
                ]
            },
            {
                id: 7,
                title: "Le Voyage : Bagages & Aéroport",
                icon: "plane-takeoff",
                color: "#fdf4ff",
                iconColor: "#c026d3",
                tag: { text: "La Pratique", class: "tag-pratique" },
                activities: [
                    { id: "m7_intro", type: "Question flash", title: "Ton niveau de stress avant le vol ?", icon: "activity" },
                    { id: "m7_valise", type: "Simulateur", title: "Je prépare ma valise (Glisser-déposer)", icon: "luggage" },
                    { id: "m7_guide", type: "Guide interactif", title: "Le guide du premier voyage en avion", icon: "book-open" },
                    { id: "m7_green_bonus", type: "Jeu", title: "Le Green Bonus Erasmus+", icon: "leaf" },
                    { id: "m7_cles", type: "Auto-évaluation", title: "Mes clés pour un voyage réussi", icon: "key-round" }
                ]
            },
            {
                id: 8,
                title: "Préparation psychologique & bien-être",
                icon: "brain-circuit",
                color: "#f0f9ff",
                iconColor: "#0ea5e9",
                tag: { text: "Toi d'abord", class: "tag-perso" },
                activities: [
                    { id: "m8_intro", type: "Sondage", title: "Comment te sens-tu avant de partir ?", icon: "bar-chart-3" },
                    { id: "m8_evaluation", type: "Auto-évaluation", title: "Identifier tes émotions et tes peurs", icon: "search" },
                    { id: "m8_astuces", type: "Boîte à outils", title: "Astuces anti-stress et mal du pays", icon: "archive" },
                    { id: "m8_cles", type: "Auto-évaluation", title: "Mes clés bien-être", icon: "key-round" }
                ]
            },
            {
                id: 9,
                title: "Budget & gestion financière",
                icon: "piggy-bank",
                color: "#fefce8",
                iconColor: "#eab308",
                tag: { text: "La Pratique", class: "tag-pratique" },
                activities: [
                    { id: "m9_intro", type: "Question flash", title: "As-tu déjà géré un budget ?", icon: "wallet" },
                    { id: "m9_calculateur", type: "Outil", title: "Calcule ton budget mensuel type", icon: "calculator" },
                    { id: "m9_tri", type: "Jeu de tri", title: "Dépenses fixes vs variables", icon: "columns" },
                    { id: "m9_cles", type: "Auto-évaluation", title: "Mes clés budget", icon: "key-round" }
                ]
            },
            {
                id: 10,
                title: "Vie collective / colocation",
                icon: "home",
                color: "#f1f5f9",
                iconColor: "#64748b",
                tag: { text: "Le Quotidien", class: "tag-pratique" },
                activities: [
                    { id: "m10_intro", type: "Question flash", title: "Déjà vécu en coloc ?", icon: "users" },
                    { id: "m10_pacte", type: "Générateur", title: "Crée ton 'pacte des colocs' idéal", icon: "file-signature" },
                    { id: "m10_conflits", type: "Scénarios", title: "Gérer les conflits du quotidien", icon: "message-square" },
                    { id: "m10_quiz_coloc", type: "Quiz", title: "Es-tu le colocataire parfait ?", icon: "help-circle" }
                ]
            },
            {
                id: 11,
                title: "Engagement & Valeurs",
                icon: "gem",
                color: "#fef2f2",
                iconColor: "#ef4444",
                tag: { text: "Ton Impact", class: "tag-perso" },
                activities: [
                    { id: "m11_intro", type: "Question flash", title: "Qu'est-ce qui te motive le plus ?", icon: "sparkles" },
                    { id: "m11_quiz_valeurs", type: "Quiz", title: "Quelles sont tes valeurs motrices ?", icon: "compass" },
                    { id: "m11_journal", type: "Journal de bord", title: "Ce que je veux apporter et apprendre", icon: "book-marked" },
                    { id: "m11_cles", type: "Auto-évaluation", title: "Mes clés 'Valeurs & Engagement'", icon: "key-round" }
                ]
            },
            {
                id: 12,
                title: "Vivre loin de chez soi",
                icon: "map-pin",
                color: "#fafafa",
                iconColor: "#737373",
                tag: { text: "Le Quotidien", class: "tag-pratique" },
                activities: [
                    { id: "m12_intro", type: "Question flash", title: "Ce qui t'inquiète le plus en partant...", icon: "help-circle" },
                    { id: "m12_carte_soutien", type: "Outil interactif", title: "Construis ta carte de soutien", icon: "share-2" },
                    { id: "m12_defi_opportunite", type: "Réflexion guidée", title: "Transformer un défi en opportunité", icon: "trending-up" },
                    { id: "m12_amis", type: "Mini-jeu", title: "Comment se faire des amis ?", icon: "user-plus" },
                    { id: "m12_cles", type: "Auto-évaluation", title: "Mes clés pour bien vivre loin de moi", icon: "key-round" }
                ]
            },
            {
                id: 13,
                title: "Après la mobilité : Valoriser mon expérience",
                icon: "award",
                color: "#fffbeb",
                iconColor: "#f59e0b",
                tag: { text: "L'Avenir", class: "tag-avenir" },
                activities: [
                    { id: "m13_intro", type: "Introduction", title: "Les compétences 'invisibles'", icon: "sparkles" },
                    { id: "m13_competences", type: "Exploration", title: "Découvre tes nouvelles compétences", icon: "search" },
                    { id: "m13_cv_valorisation", type: "Outil", title: "Traduis ton expérience pour ton CV", icon: "file-plus-2" },
                    { id: "m13_outils", type: "Info", title: "Les outils pour formaliser (Youthpass...)", icon: "graduation-cap" }
                ]
            }
        ];
        const quizQuestions = [
            { question: "Ta motivation principale pour partir ?", answers: [ { text: "Acquérir de l'expérience professionnelle pour mon CV", points: { stage: 3 } }, { text: "Aider les autres et contribuer à des causes importantes", points: { volontariat: 3 } }, { text: "Découvrir de nouvelles cultures et rencontrer du monde", points: { echange: 3, volontariat: 1 } }, { text: "Vivre une première expérience internationale", points: { echange: 2, stage: 1 } }, { text: "Sortir de ma routine et me challenger", points: { stage: 2, volontariat: 2, echange: 2 } } ] },
            { question: "Ton rapport au travail et à l'engagement ?", answers: [ { text: "J'aime quand c'est concret et que je vois le résultat de mes efforts", points: { stage: 3 } }, { text: "Je préfère quand ça a du sens et que ça aide les autres", points: { volontariat: 3 } }, { text: "J'aime découvrir, expérimenter, essayer plein de choses", points: { echange: 3 } }, { text: "Je veux apprendre un métier qui m'intéresse", points: { stage: 2, volontariat: 1 } }, { text: "Je cherche à développer mes compétences humaines", points: { volontariat: 2, echange: 2 } } ] },
            { question: "Ta durée idéale à l'étranger ?", answers: [ { text: "Quelques semaines pour goûter", points: { echange: 3 } }, { text: "2-3 mois pour une vraie expérience", points: { stage: 2, volontariat: 1 } }, { text: "6 mois à 1 an pour vraiment m'immerger", points: { volontariat: 2, stage: 2 } }, { text: "Ça dépend de ce que je vis sur place", points: { stage: 1, volontariat: 1, echange: 1 } }, { text: "Le plus court possible pour commencer", points: { echange: 2 } } ] },
            { question: "Comment tu préfères apprendre ?", answers: [ { text: "En pratiquant directement, les mains dans le cambouis", points: { stage: 3 } }, { text: "En échangeant avec les autres, en équipe", points: { volontariat: 3, echange: 2 } }, { text: "À travers des activités créatives et ludiques", points: { echange: 3 } }, { text: "En découvrant au fur et à mesure, par l'expérience", points: { echange: 2, volontariat: 1 } }, { text: "En me confrontant à de vrais défis", points: { stage: 2, volontariat: 1 } } ] },
            { question: "Ton niveau de langue étrangère ?", answers: [ { text: "Je me débrouille mais j'ai peur de ne pas comprendre au travail", points: { echange: 2, volontariat: 1 } }, { text: "Ça va, je peux avoir des conversations simples", points: { stage: 2, volontariat: 2 } }, { text: "Je suis débutant(e) mais super motivé(e) pour apprendre", points: { echange: 3, volontariat: 1 } }, { text: "J'aimerais partir dans un pays où je peux améliorer mon niveau", points: { stage: 1, volontariat: 1, echange: 1 } }, { text: "Peu importe, je me débrouille toujours", points: { stage: 2 } } ] },
            { question: "Tes centres d'intérêt principaux ?", answers: [ { text: "Le sport, l'art, la musique, la culture", points: { echange: 3, volontariat: 2 } }, { text: "L'environnement, le social, aider les autres", points: { volontariat: 3 } }, { text: "Découvrir des métiers, apprendre des techniques", points: { stage: 3 } }, { text: "Voyager, découvrir, rencontrer des gens", points: { echange: 3, volontariat: 1 } }, { text: "L'artisanat, créer des choses avec mes mains", points: { stage: 2, echange: 1 } } ] },
            { question: "Ton niveau d'autonomie actuel ?", answers: [ { text: "Je suis très autonome, je me débrouille seul(e)", points: { stage: 2 } }, { text: "J'aime être accompagné(e) au début puis voler de mes propres ailes", points: { volontariat: 2 } }, { text: "Je préfère être en groupe, ça me rassure", points: { echange: 3 } }, { text: "Ça dépend du domaine", points: { stage: 1, volontariat: 1, echange: 1 } }, { text: "J'aimerais gagner en autonomie grâce à cette expérience", points: { volontariat: 2, echange: 2 } } ] },
            { question: "Ta plus grande motivation pour cette expérience ?", answers: [ { text: "Développer des compétences professionnelles", points: { stage: 3 } }, { text: "Contribuer à quelque chose de plus grand que moi", points: { volontariat: 3 } }, { text: "Élargir mes horizons et ma vision du monde", points: { echange: 3 } }, { text: "Gagner en confiance et maturité", points: { stage: 2, volontariat: 2, echange: 2 } }, { text: "Créer des liens avec des jeunes d'autres pays", points: { echange: 2, volontariat: 2 } } ] },
            { question: "Ton entourage dit de toi que tu es... ?", answers: [ { text: "Travailleur/se et persévérant(e)", points: { stage: 2 } }, { text: "Généreux/se et à l'écoute des autres", points: { volontariat: 3 } }, { text: "Sociable et ouvert(e)", points: { echange: 2 } }, { text: "Débrouillard(e) et adaptable", points: { stage: 2, volontariat: 1 } }, { text: "Curieux/se et créatif/ve", points: { echange: 2, volontariat: 1 } } ] },
            { question: "Le type de projet qui t'attire le plus ?", answers: [ { text: "Travailler dans une entreprise locale et découvrir un métier", points: { stage: 3 } }, { text: "Aider dans une association ou une ONG", points: { volontariat: 3 } }, { text: "Participer à un projet artistique ou culturel international", points: { echange: 3 } }, { text: "Tout ce qui me fait sortir de ma zone de confort", points: { stage: 1, volontariat: 1, echange: 1 } }, { text: "Un projet où je peux être créatif/ve", points: { echange: 2, volontariat: 1 } } ] },
            { question: "Après cette expérience, tu te vois comment ?", answers: [ { text: "Avec de nouvelles compétences techniques", points: { stage: 3 } }, { text: "Plus ouvert(e), plus confiant(e), plus mature", points: { volontariat: 2, echange: 2 } }, { text: "Avec un réseau d'amis européens", points: { echange: 3, volontariat: 2 } }, { text: "Avec une meilleure idée de ce que je veux faire", points: { stage: 2, volontariat: 1 } }, { text: "Avec l'envie de repartir !", points: { stage: 1, volontariat: 1, echange: 1 } } ] },
            { question: "Ton pays de rêve pour cette expérience ?", answers: [ { text: "L'Allemagne (économie forte, rigueur)", points: { stage: 2 } }, { text: "L'Espagne (convivialité, climat, culture)", points: { echange: 2 } }, { text: "Les pays nordiques (société égalitaire, environnement)", points: { volontariat: 2 } }, { text: "L'Italie (art, gastronomie, dolce vita)", points: { echange: 2 } }, { text: "Je suis ouvert(e) à tous les pays !", points: { stage: 1, volontariat: 1, echange: 1 } } ] }
        ];

        // --- UI Elements ---
        const grid = document.getElementById('modules-grid');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const modal = document.getElementById('activity-modal');
        const modalContent = document.getElementById('activity-modal-content');
        let completedModules = new Set(JSON.parse(localStorage.getItem('completedModules')) || []);

        // --- Functions ---
        function updateProgress() {
            const progressPercentage = (modulesData.length > 0) ? (completedModules.size / modulesData.length) * 100 : 0;
            progressBar.style.width = `${progressPercentage}%`;
            progressText.textContent = `${Math.round(progressPercentage)}%`;
            
            document.querySelectorAll('.module-card').forEach(card => {
                const moduleId = parseInt(card.dataset.id);
                if (completedModules.has(moduleId)) {
                    card.classList.add('completed');
                } else {
                    card.classList.remove('completed');
                }
            });
        }

        function showModal(contentHTML) {
            modalContent.innerHTML = contentHTML;
            lucide.createIcons();
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function hideModal() {
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 200);
        }
        
        window.hideModal = hideModal;
        
        // --- Activity Rendering ---
        function renderActivity(activityId) {
            let contentHTML = '';
            let args = arguments;

            // --- MODULE 1 ACTIVITIES ---
            if (activityId.startsWith('m1_')) {
                switch (activityId) {
                    case 'm1_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4">
                                        <i data-lucide="rocket" class="h-8 w-8 text-blue-600"></i>
                                    </div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Bienvenue dans l'Étape 1 !</h3>
                                    <p class="text-gray-600 mb-6">Tu rêves de découvrir l'Europe, d'acquérir de nouvelles compétences, de vivre une expérience unique ? Tu es au bon endroit ! Découvrons ensemble quel type de mobilité te correspond vraiment.</p>
                                </div>
                                <div class="mt-6 flex flex-col sm:flex-row-reverse gap-3">
                                    <button onclick="renderActivity('m1_quiz')" class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Commencer le Quiz <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button>
                                    <button onclick="renderActivity('m1_theory')" class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-2 border border-gray-300 text-base font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50">En savoir plus d'abord</button>
                                </div>
                            </div>`;
                        break;
                    case 'm1_theory':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Les 3 types de mobilité</h3>
                                <div class="space-y-4 text-gray-600">
                                    <details class="bg-gray-50 p-4 rounded-lg"><summary class="font-semibold cursor-pointer">💼 Stage Professionnel</summary><p class="mt-2">Une période de formation pratique en entreprise pour acquérir une expérience concrète. Idéal si tu veux tester un métier et développer des compétences techniques.</p></details>
                                    <details class="bg-gray-50 p-4 rounded-lg"><summary class="font-semibold cursor-pointer">🤝 Volontariat Européen</summary><p class="mt-2">Engage-toi pour une cause qui te tient à cœur (environnement, social, culture...). Parfait si tu cherches à donner du sens à ton expérience et à vivre en communauté.</p></details>
                                    <details class="bg-gray-50 p-4 rounded-lg"><summary class="font-semibold cursor-pointer">🎓 Échange de Jeunes</summary><p class="mt-2">Découvre un pays sur une courte durée en groupe avec d'autres jeunes européens, autour d'un thème (art, sport, citoyenneté...). Idéal pour un premier pas vers l'international.</p></details>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m1_quiz')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">J'ai compris, au Quiz ! <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm1_quiz':
                        let questionsHTML = quizQuestions.map((q, index) => `<div class="mb-6"><p class="font-bold text-lg mb-2">${index + 1}. ${q.question}</p><div id="q-${index}-options">${q.answers.map((a, aIndex) => `<label class="quiz-option" for="q${index}a${aIndex}"><input type="radio" name="q${index}" id="q${index}a${aIndex}" value="${aIndex}">${a.text}</label>`).join('')}</div></div>`).join('');
                        contentHTML = `<form id="mobility-quiz"><div class="p-6 md:p-8"><h3 class="text-2xl font-bold mb-4 text-gray-900">Quel type de mobilité est fait pour toi ?</h3>${questionsHTML}<div class="mt-6 text-right"><button type="submit" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Voir mes résultats</button></div></div></form>`;
                        break;
                    case 'm1_quiz_results':
                        const scores = args[1] || { stage: 0, volontariat: 0, echange: 0 };
                        const sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
                        const topProfile = sortedScores[0][0];
                        let resultHTML = '';
                        switch(topProfile) {
                            case 'stage': resultHTML = `<div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4"><i data-lucide="briefcase" class="h-8 w-8 text-blue-600"></i></div><h4 class="text-2xl font-bold text-blue-800">Profil Majoritaire : Stage Professionnel</h4><p class="mt-2 text-gray-600">Tu es dans une démarche concrète. Tu veux acquérir une vraie expérience qui t'aidera pour ton avenir pro. Tu as envie d'apprendre en faisant !</p><div class="mt-4 text-left bg-blue-50 p-4 rounded-lg"><h5 class="font-bold">Prochaines étapes :</h5><ul class="list-disc list-inside mt-2"><li>Identifier 2-3 secteurs qui t'intéressent.</li><li>Préparer ton CV européen (Europass).</li><li>Te renseigner sur les bourses Erasmus+.</li></ul></div>`; break;
                            case 'volontariat': resultHTML = `<div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-4"><i data-lucide="heart" class="h-8 w-8 text-green-600"></i></div><h4 class="text-2xl font-bold text-green-800">Profil Majoritaire : Volontariat Européen</h4><p class="mt-2 text-gray-600">Tu es animé(e) par des valeurs de solidarité et tu veux donner du sens à ton expérience. Tu aimes le travail en équipe et les relations humaines.</p><div class="mt-4 text-left bg-green-50 p-4 rounded-lg"><h5 class="font-bold">Prochaines étapes :</h5><ul class="list-disc list-inside mt-2"><li>Identifier les causes qui te tiennent à cœur.</li><li>Explorer les offres du Corps Européen de Solidarité.</li><li>Préparer une lettre de motivation engagée.</li></ul></div>`; break;
                            case 'echange': resultHTML = `<div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-yellow-100 mb-4"><i data-lucide="users" class="h-8 w-8 text-yellow-600"></i></div><h4 class="text-2xl font-bold text-yellow-800">Profil Majoritaire : Échange de Jeunes</h4><p class="mt-2 text-gray-600">Tu es curieux/se et ouvert(e) sur le monde. Tu veux découvrir l'Europe et rencontrer des jeunes d'autres pays, sur une expérience courte mais intense.</p><div class="mt-4 text-left bg-yellow-50 p-4 rounded-lg"><h5 class="font-bold">Prochaines étapes :</h5><ul class="list-disc list-inside mt-2"><li>Explorer les offres Erasmus+ Jeunesse.</li><li>Choisir des thèmes qui te passionnent (art, sport...).</li><li>Te rapprocher des associations de jeunesse.</li></ul></div>`; break;
                        }
                        contentHTML = `<div class="p-6 md:p-8 text-center">${resultHTML}<p class="mt-6 text-sm text-gray-500">Tes scores : Stage (${scores.stage}), Volontariat (${scores.volontariat}), Échange (${scores.echange})</p><div class="mt-6"><button onclick="renderActivity('m1_carnet')" class="w-full sm:w-auto inline-flex justify-center items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer vers mon Carnet de Bord <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div></div>`;
                        break;
                    case 'm1_carnet':
                         contentHTML = `<div class="p-6 md:p-8"><h3 class="text-2xl font-bold mb-4 text-gray-900">Mon Carnet de Bord</h3><div class="space-y-4"><div><label class="font-semibold" for="apprehension1">Mes 2 plus grandes appréhensions :</label><input type="text" id="apprehension1" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"><input type="text" id="apprehension2" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></div><div><label class="font-semibold" for="motivation-level">Mon niveau de motivation actuel :</label><input type="range" id="motivation-level" min="1" max="10" value="7" class="mt-1 w-full"></div></div><div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer l'étape 1</button></div></div>`;
                        break;
                }
            }

            // --- MODULE 2 ACTIVITIES ---
            else if (activityId.startsWith('m2_')) {
                 switch (activityId) {
                    case 'm2_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-cyan-100 mb-4"><i data-lucide="file-signature" class="h-8 w-8 text-cyan-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Statuts, Droits & Devoirs</h3>
                                    <p class="text-gray-600 mb-6">Selon que tu sois volontaire, stagiaire ou autre, tes droits et devoirs varient. Les connaître, c’est éviter les mauvaises surprises et partir serein. Commençons par un petit quiz !</p>
                                </div>
                                <div id="m2_quiz_vrai_faux">
                                    <div class="space-y-3">
                                        <p class="font-semibold">1. L’allocation CEJ s’arrête pendant un volontariat CES.</p>
                                        <div><label class="quiz-option"><input type="radio" name="q1" value="faux"> Faux</label><label class="quiz-option"><input type="radio" name="q1" value="vrai"> Vrai</label></div>
                                        <p class="font-semibold">2. Un stagiaire Erasmus+ signe une convention tripartite.</p>
                                        <div><label class="quiz-option"><input type="radio" name="q2" value="faux"> Faux</label><label class="quiz-option"><input type="radio" name="q2" value="vrai"> Vrai</label></div>
                                    </div>
                                    <div class="mt-6 flex justify-between items-center">
                                        <button onclick="hideModal()" class="text-sm font-semibold text-gray-600 hover:text-gray-800">Fermer</button>
                                        <button id="check_m2_quiz1" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Vérifier & Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button>
                                    </div>
                                </div>
                            </div>`;
                        break;
                    case 'm2_drag_drop':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Associe les caractéristiques</h3>
                                <p class="text-gray-600 mb-6">Fais glisser chaque élément dans la bonne catégorie.</p>
                                <div class="grid grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-bold mb-2 text-center">Éléments</h4>
                                        <div id="draggable-items" class="space-y-2 p-2 bg-gray-100 rounded-lg">
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="stagiaire">Convention tripartite</div>
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="volontaire">Indemnité CES + logement</div>
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="stagiaire">Bourse Erasmus+</div>
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="volontaire">Tuteur obligatoire</div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-bold mb-2 text-center">Catégories</h4>
                                        <div class="space-y-4">
                                            <div><h5 class="font-semibold mb-1">Stagiaire</h5><div class="drop-zone p-2 rounded-lg" data-zone="stagiaire"></div></div>
                                            <div><h5 class="font-semibold mb-1">Volontaire</h5><div class="drop-zone p-2 rounded-lg" data-zone="volontaire"></div></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">J'ai terminé !</button></div>
                            </div>`;
                        break;
                    case 'm2_qui_contacter':
                         contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Qui contacter ?</h3>
                                <div id="scenario-container" class="space-y-4">
                                    <!-- Scenarios will be injected here -->
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">J'ai compris !</button></div>
                            </div>`;
                        break;
                    case 'm2_checklist':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mes Devoirs & Responsabilités</h3>
                                <div class="space-y-3">
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Je m'engage à respecter les horaires.</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Je sais à qui signaler une absence.</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Je m'engage à participer activement.</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Je m'engage à respecter la culture locale.</label>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Je m'engage !</button></div>
                            </div>`;
                        break;
                }
            }
            
            // --- MODULE 3 ACTIVITIES ---
            else if (activityId.startsWith('m3_')) {
                 switch (activityId) {
                    case 'm3_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-orange-100 mb-4"><i data-lucide="globe-2" class="h-8 w-8 text-orange-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Sensibilisation Interculturelle</h3>
                                    <p class="text-gray-600 mb-6">Partir, c'est découvrir une nouvelle culture. Cela peut être génial, mais aussi déstabilisant. Ce module va t'aider à comprendre et gérer le "choc culturel".</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">Quand tu imagines partir, tu ressens plutôt :</p>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200">Excitation</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200">Stress</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200">Curiosité</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200">Peur de l'inconnu</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m3_choc')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm3_choc':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Simulateur : Choc Culturel</h3>
                                <div id="choc-scenario-container">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <p class="font-semibold">Situation : On te sert un plat que tu ne connais pas du tout et qui te semble peu appétissant. Comment réagis-tu ?</p>
                                        <div class="flex flex-wrap gap-2 mt-2">
                                            <button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="C'est une bonne réaction ! La curiosité et l'humour sont de super alliés pour découvrir une nouvelle culture.">Goûter avec humour</button>
                                            <button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Refuser poliment est possible, mais essaie de ne pas te fermer. L'ouverture est la clé de l'expérience interculturelle.">Refuser poliment</button>
                                            <button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Attention, cette réaction peut être perçue comme un jugement. L'idée n'est pas de tout aimer, mais de rester ouvert et respectueux.">Faire une grimace</button>
                                        </div>
                                        <p id="choc-feedback" class="text-sm mt-2 text-blue-700 font-medium hidden"></p>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m3_stereotypes')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Activité suivante <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm3_stereotypes':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Vrai ou Faux : les stéréotypes</h3>
                                <div id="m3_quiz_stereotypes">
                                    <div class="space-y-4">
                                        <div>
                                            <p class="font-semibold">1. Tous les Italiens mangent des pâtes tous les jours.</p>
                                            <div><label class="quiz-option"><input type="radio" name="sq1" value="faux"> Faux</label><label class="quiz-option"><input type="radio" name="sq1" value="vrai"> Vrai</label></div>
                                            <p class="stereotype-feedback hidden text-sm mt-1 text-gray-600">❌ Faux. C'est un cliché ! Bien que les pâtes soient un pilier de la cuisine italienne, leur alimentation est très variée et régionale.</p>
                                        </div>
                                        <div>
                                            <p class="font-semibold">2. En Finlande, le sauna fait partie des traditions culturelles.</p>
                                            <div><label class="quiz-option"><input type="radio" name="sq2" value="faux"> Faux</label><label class="quiz-option"><input type="radio" name="sq2" value="vrai"> Vrai</label></div>
                                            <p class="stereotype-feedback hidden text-sm mt-1 text-gray-600">✅ Vrai. Le sauna est une institution en Finlande, un lieu de socialisation et de détente très important dans la culture.</p>
                                        </div>
                                    </div>
                                    <div class="mt-6 text-right"><button id="check_m3_quiz2" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Vérifier mes réponses</button></div>
                                </div>
                            </div>`;
                        break;
                    case 'm3_cles':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mes clés pour réussir</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="font-semibold" for="adapt-level">Je me sens capable de m’adapter à une culture différente (1=pas du tout, 5=totalement)</label>
                                        <input type="range" id="adapt-level" min="1" max="5" value="3" class="mt-1 w-full">
                                    </div>
                                    <div>
                                        <p class="font-semibold">Quand je ne comprends pas une situation, je préfère…</p>
                                        <div class="flex flex-col gap-2 mt-2">
                                            <label class="quiz-option"><input type="radio" name="reaction"> Observer</label>
                                            <label class="quiz-option"><input type="radio" name="reaction"> Poser une question</label>
                                            <label class="quiz-option"><input type="radio" name="reaction"> Éviter</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer le module 3</button></div>
                            </div>`;
                        break;
                }
            }
            
            // --- MODULE 4 ACTIVITIES ---
            else if (activityId.startsWith('m4_')) {
                 switch (activityId) {
                    case 'm4_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4"><i data-lucide="heart-pulse" class="h-8 w-8 text-red-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Santé & Sécurité</h3>
                                    <p class="text-gray-600 mb-6">Bien se préparer, c’est être plus serein et éviter des situations compliquées. Serais-tu prêt(e) en cas de pépin ?</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">Si tu tombes malade à l’étranger, tu sais exactement quoi faire ?</p>
                                    <div id="m4_flash_question_feedback" class="text-center text-sm font-semibold text-blue-700 mb-2 h-5"></div>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Super ! Ce module sera une bonne révision.">Oui, je suis prêt</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Pas de souci, ce module est fait pour toi !">Pas vraiment</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Alors tu es au bon endroit pour tout apprendre !">Pas du tout</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m4_trousse')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm4_trousse':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Ma trousse de secours perso</h3>
                                <p class="text-gray-600 mb-4">Coche ce que tu as déjà pour voir ce qu'il te manque.</p>
                                <div class="space-y-3">
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Pansements, désinfectant</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Médicaments de base (paracétamol...)</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Médicaments personnels (avec ordonnance)</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Masques, gel hydroalcoolique</label>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m4_assurance')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant : l'assurance <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm4_assurance':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Comprendre ton assurance</h3>
                                <div id="m4_qcm_assurance">
                                    <div class="space-y-4">
                                        <div>
                                            <p class="font-semibold">1. La CEAM (Carte Européenne d'Assurance Maladie) couvre les soins hors Europe.</p>
                                            <div><label class="quiz-option"><input type="radio" name="aq1" value="faux"> Faux</label><label class="quiz-option"><input type="radio" name="aq1" value="vrai"> Vrai</label></div>
                                        </div>
                                        <div>
                                            <p class="font-semibold">2. Cigna est une assurance complémentaire souvent utilisée dans le programme CES.</p>
                                            <div><label class="quiz-option"><input type="radio" name="aq2" value="faux"> Faux</label><label class="quiz-option"><input type="radio" name="aq2" value="vrai"> Vrai</label></div>
                                        </div>
                                         <div>
                                            <p class="font-semibold">3. Tu peux voyager avec tes médicaments personnels sans ordonnance.</p>
                                            <div><label class="quiz-option"><input type="radio" name="aq3" value="faux"> Faux</label><label class="quiz-option"><input type="radio" name="aq3" value="vrai"> Vrai</label></div>
                                        </div>
                                    </div>
                                    <div class="mt-6 text-right"><button id="check_m4_qcm" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Vérifier mes réponses</button></div>
                                </div>
                            </div>`;
                        break;
                    case 'm4_urgence':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Qui appeler en cas d'urgence ?</h3>
                                <div id="scenario-container-urgence" class="space-y-4">
                                    <!-- Scenarios will be injected here -->
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">J'ai tout noté !</button></div>
                            </div>`;
                        break;
                }
            }
            // --- MODULE 5 ACTIVITIES ---
            else if (activityId.startsWith('m5_')) {
                 switch (activityId) {
                    case 'm5_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-purple-100 mb-4"><i data-lucide="folder-kanban" class="h-8 w-8 text-purple-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">La Paperasse : Documents & Démarches</h3>
                                    <p class="text-gray-600 mb-6">Partir, ce n’est pas seulement préparer sa valise, il faut aussi préparer ses documents pour éviter les blocages. Es-tu sûr(e) d'être à jour ?</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">As-tu déjà vérifié la date de validité de ton passeport ou ta carte d’identité ?</p>
                                    <div id="m5_flash_question_feedback" class="text-center text-sm font-semibold text-blue-700 mb-2 h-5"></div>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="✅ Super ! Tu as le bon réflexe.">Oui</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="⚠️ Attention, vérifie vite ! Un document périmé peut bloquer ton départ.">Non</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m5_documents')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm5_documents':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Checklist des documents de voyage</h3>
                                <p class="text-gray-600 mb-4">Coche les documents que tu as déjà préparés.</p>
                                <div class="space-y-3">
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Carte d’identité / passeport valide</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Visa (si nécessaire)</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Billets de transport</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Attestation d'hébergement</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Copies numériques de tous les documents</label>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m5_cej')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant : Lien avec la Mission Locale <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm5_cej':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Garder le lien avec ton conseiller</h3>
                                <p class="text-gray-600 mb-4">Cas pratique : Tu pars en Erasmus+ pour 3 mois et tu oublies de prévenir ton conseiller. Quelles sont les conséquences ?</p>
                                <div id="m5_qcm_cej">
                                    <div class="space-y-3">
                                        <label class="quiz-option"><input type="radio" name="cej_q" value="incorrect"> Aucune.</label>
                                        <label class="quiz-option"><input type="radio" name="cej_q" value="correct"> Perte ou suspension de l’allocation CEJ/PACEA.</label>
                                        <label class="quiz-option"><input type="radio" name="cej_q" value="incorrect"> Bonus de mobilité.</label>
                                    </div>
                                    <div class="mt-6 text-right"><button id="check_m5_cej" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Vérifier</button></div>
                                </div>
                            </div>`;
                        break;
                    case 'm5_assurance_docs':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Les documents d'assurance</h3>
                                <div id="m5_qcm_assurance">
                                    <div class="space-y-4">
                                        <div>
                                            <p class="font-semibold">1. La CEAM est valable partout dans le monde.</p>
                                            <div><label class="quiz-option"><input type="radio" name="as1" value="faux"> Faux</label><label class="quiz-option"><input type="radio" name="as1" value="vrai"> Vrai</label></div>
                                        </div>
                                        <div>
                                            <p class="font-semibold">2. L’assurance responsabilité civile couvre les dommages que tu causes à autrui.</p>
                                            <div><label class="quiz-option"><input type="radio" name="as2" value="faux"> Faux</label><label class="quiz-option"><input type="radio" name="as2" value="vrai"> Vrai</label></div>
                                        </div>
                                    </div>
                                    <div class="mt-6 text-right"><button id="check_m5_assurance" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Vérifier et Terminer</button></div>
                                </div>
                            </div>`;
                        break;
                }
            }
            // --- MODULE 6 INTERACTIONS ---
            else if (activityId.startsWith('m6_')) {
                 switch (activityId) {
                    case 'm6_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-teal-100 mb-4"><i data-lucide="languages" class="h-8 w-8 text-teal-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Soutien Linguistique</h3>
                                    <p class="text-gray-600 mb-6">Parler une autre langue peut faire peur, mais avec les bons outils comme OLS, tu seras prêt(e) !</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">Comment tu te sens à l’idée de parler une autre langue ?</p>
                                    <div id="m6_flash_question_feedback" class="text-center text-sm font-semibold text-blue-700 mb-2 h-5"></div>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Génial, OLS va te permettre de te perfectionner !">À l’aise 😎</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="C'est normal, OLS est fait pour te donner confiance.">Un peu stressé 😬</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Pas d’inquiétude, OLS est là pour t’aider pas à pas !">Très inquiet 😰</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m6_tuto')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm6_tuto':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Tutoriel : S'inscrire à OLS</h3>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <p class="font-semibold">Le processus est simple :</p>
                                    <ul class="list-decimal list-inside mt-2 space-y-1 text-gray-600">
                                        <li>Ton organisme (Mission Locale...) t'envoie un lien d'inscription.</li>
                                        <li>Tu crées ton compte avec ton email.</li>
                                        <li>Tu passes un test rapide pour évaluer ton niveau.</li>
                                        <li>La plateforme te propose un parcours adapté. C'est parti !</li>
                                    </ul>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m6_defi')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant : Défi linguistique <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm6_defi':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Défi : 5 phrases clés</h3>
                                <p class="text-gray-600 mb-4">Associe la phrase française à sa traduction en anglais.</p>
                                <div id="m6_defi_container" class="space-y-4">
                                    <!-- Phrases will be injected by JS -->
                                </div>
                                <div class="mt-6 text-right"><button id="check_m6_defi" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Vérifier mes associations</button></div>
                            </div>`;
                        break;
                    case 'm6_cles':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mes clés linguistiques</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="font-semibold" for="lang-level">Je me sens capable de me débrouiller dans la langue du pays d’accueil (1=pas du tout, 5=totalement)</label>
                                        <input type="range" id="lang-level" min="1" max="5" value="3" class="mt-1 w-full">
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer le module 6</button></div>
                            </div>`;
                        break;
                }
            }
            // --- MODULE 7 ACTIVITIES ---
            else if (activityId.startsWith('m7_')) {
                 switch (activityId) {
                    case 'm7_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-pink-100 mb-4"><i data-lucide="plane-takeoff" class="h-8 w-8 text-pink-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Le Voyage : Bagages & Aéroport</h3>
                                    <p class="text-gray-600 mb-6">Préparer ton voyage te permettra de partir l’esprit tranquille. Prêt(e) à décoller ?</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">Ton niveau de stress à l’idée de prendre l’avion ?</p>
                                    <div id="m7_flash_question_feedback" class="text-center text-sm font-semibold text-blue-700 mb-2 h-5"></div>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Top ! Tu es prêt(e) pour l'aventure.">Pas du tout stressé ✈️</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="C'est normal, ce module va t'aider.">Un peu stressé 😬</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Pas d’inquiétude, ce module va tout clarifier pas à pas !">Très stressé 😱</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m7_valise')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm7_valise':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Je prépare ma valise</h3>
                                <p class="text-gray-600 mb-6">Classe les objets dans la bonne valise : cabine ou soute.</p>
                                <div class="grid grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-bold mb-2 text-center">Objets</h4>
                                        <div id="draggable-items" class="space-y-2 p-2 bg-gray-100 rounded-lg">
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="cabine">Passeport</div>
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="soute">Gel douche (200ml)</div>
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="cabine">Ordinateur portable</div>
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="cabine">Médicaments avec ordonnance</div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-bold mb-2 text-center">Valises</h4>
                                        <div class="space-y-4">
                                            <div><h5 class="font-semibold mb-1">Bagage Cabine</h5><div class="drop-zone p-2 rounded-lg" data-zone="cabine"></div></div>
                                            <div><h5 class="font-semibold mb-1">Bagage en Soute</h5><div class="drop-zone p-2 rounded-lg" data-zone="soute"></div></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m7_guide')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm7_guide':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Le guide du premier vol</h3>
                                <div id="m7_qcm_guide">
                                    <div class="space-y-4">
                                        <div>
                                            <p class="font-semibold">1. À quel moment déposes-tu ton bagage en soute ?</p>
                                            <div>
                                                <label class="quiz-option"><input type="radio" name="gq1" value="vrai"> Avant le contrôle de sécurité</label>
                                                <label class="quiz-option"><input type="radio" name="gq1" value="faux"> Après l’embarquement</label>
                                            </div>
                                        </div>
                                        <div>
                                            <p class="font-semibold">2. Où gardes-tu ton passeport ?</p>
                                            <div>
                                                <label class="quiz-option"><input type="radio" name="gq2" value="vrai"> Dans ton bagage cabine</label>
                                                <label class="quiz-option"><input type="radio" name="gq2" value="faux"> Dans ta valise en soute</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-6 text-right"><button id="check_m7_guide" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Vérifier mes réponses</button></div>
                                </div>
                            </div>`;
                        break;
                    case 'm7_green_bonus':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Le Green Bonus Erasmus+</h3>
                                <p class="text-gray-600 mb-6">Associe chaque mode de transport avec l'aide Erasmus+.</p>
                                <div id="m7_bonus_game" class="space-y-4">
                                    <div class="bg-gray-50 p-4 rounded-lg"><p class="font-semibold">Avion</p><div class="flex flex-wrap gap-2 mt-2"><button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="non">Pas de Green Bonus</button><button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="oui">✅ Green Bonus</button></div></div>
                                    <div class="bg-gray-50 p-4 rounded-lg"><p class="font-semibold">Train</p><div class="flex flex-wrap gap-2 mt-2"><button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="non">Pas de Green Bonus</button><button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="oui">✅ Green Bonus</button></div></div>
                                    <div class="bg-gray-50 p-4 rounded-lg"><p class="font-semibold">Covoiturage</p><div class="flex flex-wrap gap-2 mt-2"><button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="non">Pas de Green Bonus</button><button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="oui">✅ Green Bonus</button></div></div>
                                    <div class="bg-gray-50 p-4 rounded-lg"><p class="font-semibold">Bus</p><div class="flex flex-wrap gap-2 mt-2"><button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="non">Pas de Green Bonus</button><button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="oui">✅ Green Bonus</button></div></div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m7_cles')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm7_cles':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mes clés pour un voyage réussi</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="font-semibold" for="travel-level">Je me sens prêt à voyager seul(e) en transport international (1=pas du tout, 5=totalement)</label>
                                        <input type="range" id="travel-level" min="1" max="5" value="3" class="mt-1 w-full">
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer le module 7</button></div>
                            </div>`;
                        break;
                }
            }
            // --- MODULE 8 ACTIVITIES ---
            else if (activityId.startsWith('m8_')) {
                 switch (activityId) {
                    case 'm8_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-sky-100 mb-4"><i data-lucide="brain-circuit" class="h-8 w-8 text-sky-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Préparation psychologique & bien-être</h3>
                                    <p class="text-gray-600 mb-6">Partir est une aventure excitante... mais ça peut aussi faire peur. C'est normal ! Ce module va te donner des clés pour gérer tes émotions.</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">À l’idée de partir, je me sens surtout…</p>
                                    <div id="m8_flash_question_feedback" class="text-center text-sm font-semibold text-blue-700 mb-2 h-5"></div>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Génial ! L'enthousiasme est un super moteur.">Excité 😃</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="C'est tout à fait normal, et on va voir comment le gérer.">Stressé 😰</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Parfait ! La curiosité t'aidera à t'ouvrir.">Curieux 🤔</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Ce module est là pour te donner confiance.">Pas sûr de moi 😕</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m8_evaluation')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm8_evaluation':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Identifier tes émotions</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="font-semibold" for="ready-level">Je me sens prêt(e) à affronter une nouvelle expérience (1=pas du tout, 5=totalement)</label>
                                        <input type="range" id="ready-level" min="1" max="5" value="3" class="mt-1 w-full">
                                    </div>
                                    <div>
                                        <p class="font-semibold">Mes principales peurs avant de partir sont…</p>
                                        <div class="flex flex-col gap-2 mt-2">
                                            <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> La barrière de la langue</label>
                                            <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> La solitude, l'éloignement</label>
                                            <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Le voyage en lui-même</label>
                                            <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Ne pas réussir à m'intégrer</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m8_astuces')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Découvrir des astuces <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm8_astuces':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Boîte à outils anti-stress</h3>
                                <p class="text-gray-600 mb-4">Clique sur une astuce pour en savoir plus.</p>
                                <div class="flex flex-wrap gap-2">
                                    <button class="astuce-btn text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Inspire lentement par le nez (4s), bloque (4s), puis expire doucement par la bouche (6s). Répète 5 fois.">Exercice de respiration</button>
                                    <button class="astuce-btn text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Prends un objet qui te rassure (photo, souvenir). Il t'aidera à te sentir 'comme à la maison' dans les moments de doute.">Garder un objet 'repère'</button>
                                    <button class="astuce-btn text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Chaque soir, note une petite chose positive de ta journée. Ça aide à voir le bon côté des choses, même quand c'est dur.">Le carnet de 'victoires'</button>
                                    <button class="astuce-btn text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Fixe des rdv réguliers avec tes proches, mais pas tous les jours. L'idée est de garder le lien sans t'empêcher de vivre ta nouvelle vie.">Appeler ses proches (avec modération)</button>
                                </div>
                                <p id="astuce-feedback" class="text-sm mt-4 text-blue-700 font-medium bg-blue-50 p-3 rounded-lg min-h-[50px]"></p>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m8_cles')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm8_cles':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mes clés bien-être</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="font-semibold" for="stress-level">Je me sens capable de gérer mon stress et mes émotions à l’étranger (1=pas du tout, 5=totalement)</label>
                                        <input type="range" id="stress-level" min="1" max="5" value="3" class="mt-1 w-full">
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer le module 8</button></div>
                            </div>`;
                        break;
                }
            }
            // --- MODULE 9 ACTIVITIES ---
            else if (activityId.startsWith('m9_')) {
                 switch (activityId) {
                    case 'm9_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-yellow-100 mb-4"><i data-lucide="piggy-bank" class="h-8 w-8 text-yellow-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Budget & gestion financière</h3>
                                    <p class="text-gray-600 mb-6">Savoir gérer ton argent, c’est éviter le stress et profiter de ton séjour sans mauvaises surprises. Prêt(e) à devenir un(e) pro du budget ?</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">As-tu déjà géré un budget seul(e) ?</p>
                                    <div id="m9_flash_question_feedback" class="text-center text-sm font-semibold text-blue-700 mb-2 h-5"></div>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Excellent ! Tu as déjà de bonnes bases.">Oui, régulièrement</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="C'est l'occasion parfaite pour apprendre.">Un peu, parfois</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Pas de panique, ce module est fait pour toi !">Non, jamais</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m9_calculateur')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm9_calculateur':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Calcule ton budget mensuel</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <label class="font-semibold">Tes revenus (€)</label>
                                        <input type="number" id="revenu_cej" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Allocation CEJ/PACEA">
                                        <input type="number" id="revenu_bourse" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Bourse Erasmus+ / Indemnité CES">
                                        <input type="number" id="revenu_autre" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Autre (famille...)">
                                    </div>
                                    <div>
                                        <label class="font-semibold">Tes dépenses (€)</label>
                                        <input type="number" id="depense_loyer" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Loyer">
                                        <input type="number" id="depense_nourriture" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Nourriture">
                                        <input type="number" id="depense_transport" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Transport">
                                        <input type="number" id="depense_loisirs" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Loisirs, sorties">
                                    </div>
                                </div>
                                <div class="mt-6 text-center">
                                    <button id="calcul_budget_btn" class="bg-blue-600 text-white py-2 px-4 rounded-lg">Calculer mon solde</button>
                                </div>
                                <div id="budget_result" class="mt-4 text-center hidden">
                                    <p class="font-bold text-lg">Ton solde mensuel est de : <span id="solde_value"></span> €</p>
                                    <div id="solde_feedback" class="mt-2 font-semibold"></div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m9_tri')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm9_tri':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Dépenses fixes vs variables</h3>
                                <p class="text-gray-600 mb-6">Classe chaque dépense dans la bonne catégorie.</p>
                                <div class="grid grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-bold mb-2 text-center">Dépenses</h4>
                                        <div id="draggable-items" class="space-y-2 p-2 bg-gray-100 rounded-lg">
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="fixe">Abonnement internet</div>
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="variable">Restaurant</div>
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="fixe">Assurance</div>
                                            <div class="p-2 bg-white rounded shadow draggable" draggable="true" data-target="variable">Vêtements</div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-bold mb-2 text-center">Catégories</h4>
                                        <div class="space-y-4">
                                            <div><h5 class="font-semibold mb-1">Dépenses Fixes</h5><div class="drop-zone p-2 rounded-lg" data-zone="fixe"></div></div>
                                            <div><h5 class="font-semibold mb-1">Dépenses Variables</h5><div class="drop-zone p-2 rounded-lg" data-zone="variable"></div></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m9_cles')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm9_cles':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mes clés budget</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="font-semibold" for="budget-level">Je me sens capable de gérer mon budget seul(e) à l’étranger (1=pas du tout, 5=totalement)</label>
                                        <input type="range" id="budget-level" min="1" max="5" value="3" class="mt-1 w-full">
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer le module 9</button></div>
                            </div>`;
                        break;
                }
            }
            // --- MODULE 10 ACTIVITIES ---
            else if (activityId.startsWith('m10_')) {
                 switch (activityId) {
                    case 'm10_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-slate-100 mb-4"><i data-lucide="home" class="h-8 w-8 text-slate-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Vie collective / colocation</h3>
                                    <p class="text-gray-600 mb-6">Vivre en colocation est une super expérience, mais elle demande quelques règles pour bien fonctionner. Ce module te donne les clés !</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">As-tu déjà vécu en colocation ou en internat ?</p>
                                    <div id="m10_flash_question_feedback" class="text-center text-sm font-semibold text-blue-700 mb-2 h-5"></div>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Parfait, tu as déjà une expérience !">Oui, sans problème</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Ce module t'aidera à mieux gérer les prochaines fois.">Oui, avec quelques tensions</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Super, tu vas découvrir les bases pour bien commencer !">Non, jamais</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m10_pacte')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm10_pacte':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Crée ton "pacte des colocs" idéal</h3>
                                <p class="text-gray-600 mb-4">Coche les règles que tu trouves importantes à inclure.</p>
                                <div class="space-y-3">
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Répartition du ménage</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Organisation des repas (communs ou séparés)</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Gestion du bruit (horaires calmes)</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3"> Règles pour les invités</label>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m10_conflits')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant : Gérer les conflits <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm10_conflits':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Gérer les conflits du quotidien</h3>
                                <div id="m10_conflit_scenario">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <p class="font-semibold">Situation : Ton coloc fait régulièrement du bruit après minuit. Tu es fatigué et ça t’énerve. Que fais-tu ?</p>
                                        <div class="flex flex-col gap-2 mt-2">
                                            <label class="quiz-option"><input type="radio" name="conflit_q" value="incorrect"> Je crie et claque la porte.</label>
                                            <label class="quiz-option"><input type="radio" name="conflit_q" value="incorrect"> J’attends et j’accumule ma colère.</label>
                                            <label class="quiz-option"><input type="radio" name="conflit_q" value="correct"> Je lui parle calmement le lendemain et je propose des règles horaires.</label>
                                        </div>
                                    </div>
                                    <div class="mt-6 text-right"><button id="check_m10_conflit" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Vérifier</button></div>
                                </div>
                            </div>`;
                        break;
                    case 'm10_quiz_coloc':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Es-tu le colocataire parfait ?</h3>
                                <div id="m10_qcm_coloc">
                                    <div class="space-y-4">
                                        <div>
                                            <p class="font-semibold">1. Tu vois la poubelle pleine, que fais-tu ?</p>
                                            <div>
                                                <label class="quiz-option"><input type="radio" name="cq1" value="0"> Je la laisse, quelqu’un d'autre s'en occupera.</label>
                                                <label class="quiz-option"><input type="radio" name="cq1" value="2"> Je la sors directement.</label>
                                                <label class="quiz-option"><input type="radio" name="cq1" value="1"> Je propose une règle pour la vider à tour de rôle.</label>
                                            </div>
                                        </div>
                                        <div>
                                            <p class="font-semibold">2. Un coloc te propose de partager les courses, tu réponds :</p>
                                            <div>
                                                <label class="quiz-option"><input type="radio" name="cq2" value="0"> Non merci, je fais toujours seul.</label>
                                                <label class="quiz-option"><input type="radio" name="cq2" value="2"> Oui, et on divise les frais équitablement.</label>
                                                <label class="quiz-option"><input type="radio" name="cq2" value="1"> Oui, mais je “zappe” souvent de rembourser.</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-6 text-right"><button id="check_m10_qcm_coloc" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Voir mon profil de coloc</button></div>
                                </div>
                            </div>`;
                        break;
                }
            }
             // --- MODULE 11 ACTIVITIES ---
            else if (activityId.startsWith('m11_')) {
                 switch (activityId) {
                    case 'm11_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100 mb-4"><i data-lucide="gem" class="h-8 w-8 text-red-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Engagement & Valeurs</h3>
                                    <p class="text-gray-600 mb-6">Partir, c'est aussi engager tes valeurs personnelles. Ce module t'aide à comprendre ce qui te motive vraiment.</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">À ton avis, qu’est-ce qui te motive le plus à partir ?</p>
                                    <div id="m11_flash_question_feedback" class="text-center text-sm font-semibold text-blue-700 mb-2 h-5"></div>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="La valeur d'ouverture est forte chez toi !">Découvrir une autre culture 🌍</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="La solidarité est une de tes valeurs motrices.">Aider les autres 💡</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Tu es guidé(e) par la valeur de responsabilité.">Gagner en autonomie 💪</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="L'ambition et le développement sont importants pour toi.">Améliorer mon futur pro 🎓</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m11_quiz_valeurs')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm11_quiz_valeurs':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Quelles sont tes valeurs motrices ?</h3>
                                <div id="m11_valeurs_qcm">
                                    <div class="space-y-4">
                                        <div>
                                            <p class="font-semibold">1. Dans ton équipe, un collègue est en difficulté sur une tâche. Que fais-tu ?</p>
                                            <div>
                                                <label class="quiz-option"><input type="radio" name="vq1" value="solidarite"> Je lui propose mon aide spontanément.</label>
                                                <label class="quiz-option"><input type="radio" name="vq1" value="responsabilite"> Je finis mon travail d'abord, c'est la priorité.</label>
                                                <label class="quiz-option"><input type="radio" name="vq1" value="ouverture"> J'observe pour comprendre sa difficulté.</label>
                                            </div>
                                        </div>
                                        <div>
                                            <p class="font-semibold">2. On te propose une nouvelle mission qui sort de ton cadre habituel.</p>
                                            <div>
                                                <label class="quiz-option"><input type="radio" name="vq2" value="ouverture"> Super ! J'adore découvrir de nouvelles choses.</label>
                                                <label class="quiz-option"><input type="radio" name="vq2" value="responsabilite"> J'accepte si les objectifs sont clairs.</label>
                                                <label class="quiz-option"><input type="radio" name="vq2" value="solidarite"> J'accepte si ça peut aider l'équipe.</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-6 text-right"><button id="check_m11_valeurs" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Voir ma valeur principale</button></div>
                                </div>
                            </div>`;
                        break;
                    case 'm11_journal':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mon Journal de Bord</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="font-semibold" for="journal_apporter">3 choses que je veux apporter à mon projet :</label>
                                        <textarea id="journal_apporter" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></textarea>
                                    </div>
                                    <div>
                                        <label class="font-semibold" for="journal_apprendre">3 choses que je veux apprendre de mon séjour :</label>
                                        <textarea id="journal_apprendre" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"></textarea>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m11_cles')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm11_cles':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mes clés "Valeurs & Engagement"</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="font-semibold" for="valeurs-level">Je sais identifier les valeurs qui guident mes choix (1=pas du tout, 5=totalement)</label>
                                        <input type="range" id="valeurs-level" min="1" max="5" value="3" class="mt-1 w-full">
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer le module 11</button></div>
                            </div>`;
                        break;
                }
            }
            // --- MODULE 12 ACTIVITIES ---
            else if (activityId.startsWith('m12_')) {
                 switch (activityId) {
                    case 'm12_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gray-200 mb-4"><i data-lucide="map-pin" class="h-8 w-8 text-gray-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Vivre loin de chez soi</h3>
                                    <p class="text-gray-600 mb-6">Partir, c'est quitter ses proches et ses repères. C'est excitant mais peut aussi être difficile. Ce module t'aide à identifier tes soutiens et à transformer les défis en opportunités.</p>
                                </div>
                                <div>
                                    <p class="font-semibold text-center mb-2">Ce qui m’inquiète le plus en partant, c’est…</p>
                                    <div id="m12_flash_question_feedback" class="text-center text-sm font-semibold text-blue-700 mb-2 h-5"></div>
                                    <div class="flex flex-wrap justify-center gap-2">
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="C'est normal, on va voir comment garder le lien.">Être loin de ma famille.</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Ne t'inquiète pas, on va voir comment créer de nouvelles amitiés.">Être seul(e).</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="C'est un défi, mais aussi une chance d'apprendre !">Ne pas savoir m’intégrer.</button>
                                        <button class="sondage-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-feedback="Super ! Ton enthousiasme est ta plus grande force.">Rien, j’ai surtout hâte.</button>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m12_carte_soutien')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm12_carte_soutien':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Construis ta carte de soutien</h3>
                                <p class="text-gray-600 mb-4">Ajoute les noms de tes contacts et classe-les dans les bonnes catégories.</p>
                                <div class="flex items-center gap-2 mb-4">
                                    <input type="text" id="new-contact-name" class="flex-grow border border-gray-300 rounded-md shadow-sm p-2" placeholder="Nom du contact...">
                                    <button id="add-contact-btn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600">Ajouter</button>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <h4 class="font-bold mb-2 text-center">Contacts</h4>
                                        <div id="draggable-items" class="space-y-2 p-2 bg-gray-100 rounded-lg min-h-[100px]">
                                            <!-- Les contacts ajoutés apparaîtront ici -->
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-bold mb-2 text-center">Mon Réseau</h4>
                                        <div class="space-y-2">
                                            <div><h5 class="font-semibold text-sm mb-1">Famille / Amis</h5><div class="drop-zone p-2 rounded-lg" data-zone="proches"></div></div>
                                            <div><h5 class="font-semibold text-sm mb-1">Professionnels</h5><div class="drop-zone p-2 rounded-lg" data-zone="pros"></div></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m12_defi_opportunite')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm12_defi_opportunite':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Transformer un défi en opportunité</h3>
                                <p class="text-gray-600 mb-4">Chaque difficulté peut être vue comme une occasion de grandir. Choisis un défi et écris comment tu pourrais le transformer en opportunité.</p>
                                <div class="space-y-4">
                                    <div>
                                        <label class="font-semibold" for="defi-select">Choisis un défi :</label>
                                        <select id="defi-select" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                                            <option>Je ne connais personne</option>
                                            <option>Je suis perdu dans la langue</option>
                                            <option>Je dois gérer seul mon quotidien</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="font-semibold" for="opportunite-text">L'opportunité que cela représente :</label>
                                        <textarea id="opportunite-text" rows="3" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2" placeholder="Ex: C'est l'occasion de rencontrer de nouvelles personnes..."></textarea>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m12_amis')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Suivant <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm12_amis':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mini-jeu : Se faire des amis</h3>
                                <div id="m12_amis_scenario">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <p class="font-semibold">Situation : Tu arrives dans un groupe de jeunes qui discutent. Que fais-tu ?</p>
                                        <div class="flex flex-col gap-2 mt-2">
                                            <label class="quiz-option"><input type="radio" name="amis_q" value="incorrect"> Je reste à l’écart en attendant qu'on vienne me parler.</label>
                                            <label class="quiz-option"><input type="radio" name="correct"> Je me présente simplement avec un sourire.</label>
                                            <label class="quiz-option"><input type="radio" name="incorrect"> Je ne dis rien et j'écoute la conversation de loin.</label>
                                        </div>
                                    </div>
                                    <div class="mt-6 text-right"><button id="check_m12_amis" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Vérifier</button></div>
                                </div>
                            </div>`;
                        break;
                    case 'm12_cles':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Mes clés pour bien vivre loin de moi</h3>
                                <div class="space-y-4">
                                    <p class="text-gray-600">Pour finir, évalue ta confiance sur ce point :</p>
                                    <div>
                                        <label class="font-semibold" for="confiance-level">Je me sens capable de vivre loin de ma famille et de trouver de nouveaux repères.</label>
                                        <div class="flex items-center justify-between text-sm text-gray-500 mt-1"><span>Pas du tout</span><span>Totalement</span></div>
                                        <input type="range" id="confiance-level" min="1" max="5" value="3" class="mt-1 w-full">
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer le module 12</button></div>
                            </div>`;
                        break;
                }
            }
             // --- MODULE 13 ACTIVITIES ---
            else if (activityId.startsWith('m13_')) {
                 switch (activityId) {
                    case 'm13_intro':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <div class="text-center">
                                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-amber-100 mb-4"><i data-lucide="award" class="h-8 w-8 text-amber-600"></i></div>
                                    <h3 class="text-2xl font-bold mb-2 text-gray-900">Valoriser ton expérience</h3>
                                    <p class="text-gray-600 mb-6">Ton expérience de mobilité est un trésor de compétences, souvent "invisibles" au premier abord. Ce module t'aide à les identifier et à les mettre en valeur pour ton avenir.</p>
                                </div>
                                 <div class="mt-6 text-center"><button onclick="renderActivity('m13_competences')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Découvrir mes compétences <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                     case 'm13_competences':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Tes Compétences Clés</h3>
                                <p class="text-gray-600 mb-4">En mobilité, tu as développé des compétences très recherchées. Explore-les !</p>
                                <div class="space-y-4 text-gray-700">
                                    <details class="bg-gray-50 p-4 rounded-lg"><summary class="font-semibold cursor-pointer flex items-center"><i data-lucide="users" class="mr-2 h-5 w-5 text-blue-500"></i>Compétences psychosociales (Life Skills)</summary><p class="mt-2 text-sm">Autonomie, résilience, communication interculturelle, confiance en soi, travail en équipe, créativité, empathie...</p></details>
                                    <details class="bg-gray-50 p-4 rounded-lg"><summary class="font-semibold cursor-pointer flex items-center"><i data-lucide="trending-up" class="mr-2 h-5 w-5 text-green-500"></i>Compétences de demain (selon les employeurs)</summary><p class="mt-2 text-sm">Pensée critique, intelligence émotionnelle, capacité d’adaptation, collaboration interculturelle, curiosité...</p></details>
                                    <details class="bg-gray-50 p-4 rounded-lg"><summary class="font-semibold cursor-pointer flex items-center"><i data-lucide="file-text" class="mr-2 h-5 w-5 text-red-500"></i>Compétences pour ton CV</summary><p class="mt-2 text-sm">Ce sont toutes ces compétences que tu peux désormais formuler pour te démarquer. On va voir comment juste après !</p></details>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m13_cv_valorisation')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Mettre ça sur mon CV <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm13_cv_valorisation':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Traduis ton expérience en compétences</h3>
                                <p class="text-gray-600 mb-4">Exemple : "Stage en Espagne et vie en colocation". Coche les compétences que tu penses avoir développées.</p>
                                <div id="m13_cv_checklist" class="space-y-3">
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3" data-skill="Autonomie (gestion du quotidien et du budget)."> Autonomie</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3" data-skill="Communication interculturelle (collaboration avec une équipe multilingue)."> Communication interculturelle</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3" data-skill="Résolution de problèmes (trouver des solutions en cas de malentendu)."> Résolution de problèmes</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3" data-skill="Confiance en soi (oser prendre la parole, s'adapter)."> Confiance en soi</label>
                                    <label class="flex items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer"><input type="checkbox" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-3" data-skill="Travail en équipe (répartition des tâches en colocation et au travail)."> Travail en équipe</label>
                                </div>
                                <div class="mt-6 bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-bold">Tes compétences pour ton CV :</h4>
                                    <ul id="cv-skills-list" class="list-disc list-inside mt-2 text-blue-800">
                                        <!-- Les compétences cochées apparaîtront ici -->
                                    </ul>
                                </div>
                                <div class="mt-6 text-right"><button onclick="renderActivity('m13_outils')" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Découvrir les outils officiels <i data-lucide="arrow-right" class="ml-2 h-4 w-4"></i></button></div>
                            </div>`;
                        break;
                    case 'm13_outils':
                        contentHTML = `
                            <div class="p-6 md:p-8">
                                <h3 class="text-2xl font-bold mb-4 text-gray-900">Les outils pour formaliser tes compétences</h3>
                                <div class="space-y-4 text-gray-600">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-semibold text-gray-800">🎓 Youthpass & Europass</h4>
                                        <p class="mt-1">Ces outils européens te permettent de décrire officiellement les compétences acquises pendant ta mobilité. C'est un vrai plus sur ton CV ! Parles-en à ton conseiller.</p>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-semibold text-gray-800">🎤 Entretien d'embauche</h4>
                                        <p class="mt-1">N'hésite pas à illustrer chaque compétence avec une anecdote concrète de ton séjour. Exemple : "J'ai développé ma capacité d'adaptation quand j'ai dû..."</p>
                                    </div>
                                </div>
                                <div class="mt-6 text-right"><button onclick="hideModal()" class="inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer le parcours !</button></div>
                            </div>`;
                        break;
                }
            }
            // --- DEFAULT "COMING SOON" ---
            else {
                contentHTML = `
                    <div class="p-6 md:p-8 text-center">
                        <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-orange-100 mb-4"><i data-lucide="construction" class="h-8 w-8 text-orange-600"></i></div>
                        <h3 class="text-2xl font-bold mb-2 text-gray-900">Activité à venir</h3>
                        <p class="text-gray-600 mb-6">Cette fonctionnalité est en cours de développement. Bientôt, vous pourrez accéder à des quiz, vidéos et simulateurs interactifs ici !</p>
                        <button onclick="hideModal()" class="w-full sm:w-auto bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">Compris !</button>
                    </div>`;
            }
            showModal(contentHTML);
            setupActivityInteractions(activityId);
        }
        
        window.renderActivity = renderActivity;

        function setupActivityInteractions(activityId) {
            // --- MODULE 1 INTERACTIONS ---
            if (activityId === 'm1_quiz') {
                const quizForm = document.getElementById('mobility-quiz');
                quizForm.addEventListener('submit', handleQuizSubmit);
                quizForm.querySelectorAll('.quiz-option').forEach(label => {
                    label.addEventListener('click', () => {
                        const radioName = label.htmlFor.slice(0, 2);
                        quizForm.querySelectorAll(`label[for^="${radioName}"]`).forEach(l => l.classList.remove('selected'));
                        label.classList.add('selected');
                    });
                });
            }
            // --- MODULE 2 INTERACTIONS ---
            else if (activityId === 'm2_intro') {
                document.getElementById('check_m2_quiz1').addEventListener('click', () => {
                    const q1 = document.querySelector('input[name="q1"]:checked');
                    const q2 = document.querySelector('input[name="q2"]:checked');
                    let allCorrect = true;
                    if (q1 && q1.value === 'faux') { q1.closest('.quiz-option').classList.add('correct'); } else if (q1) { q1.closest('.quiz-option').classList.add('incorrect'); allCorrect = false; } else { allCorrect = false; }
                    if (q2 && q2.value === 'vrai') { q2.closest('.quiz-option').classList.add('correct'); } else if (q2) { q2.closest('.quiz-option').classList.add('incorrect'); allCorrect = false; } else { allCorrect = false; }
                    if(allCorrect) { setTimeout(() => renderActivity('m2_drag_drop'), 1000); }
                });
            } else if (activityId === 'm2_drag_drop') {
                const draggables = document.querySelectorAll('.draggable');
                const dropZones = document.querySelectorAll('.drop-zone');
                let draggedItem = null;
                draggables.forEach(draggable => {
                    draggable.addEventListener('dragstart', () => { draggedItem = draggable; setTimeout(() => draggable.style.display = 'none', 0); });
                    draggable.addEventListener('dragend', () => { setTimeout(() => { draggedItem.style.display = 'block'; draggedItem = null; }, 0); });
                });
                dropZones.forEach(zone => {
                    zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
                    zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
                    zone.addEventListener('drop', () => {
                        zone.classList.remove('drag-over');
                        if (draggedItem && zone.dataset.zone === draggedItem.dataset.target) {
                            zone.appendChild(draggedItem);
                            draggedItem.setAttribute('draggable', 'false');
                        }
                    });
                });
            } else if (activityId === 'm2_qui_contacter') {
                const scenarios = [
                    { q: "Tu as perdu ton passeport.", options: ["Consulat/Ambassade", "Tuteur", "Mission Locale"], answer: "Consulat/Ambassade" },
                    { q: "Tu as un conflit avec ton encadrant.", options: ["Tuteur + Mission Locale", "112", "Ambassade"], answer: "Tuteur + Mission Locale" },
                    { q: "Tu as un problème de santé urgent.", options: ["Tuteur + 112", "Mission Locale", "Consulat"], answer: "Tuteur + 112" }
                ];
                const container = document.getElementById('scenario-container');
                container.innerHTML = scenarios.map((s, i) => `<div class="bg-gray-50 p-4 rounded-lg"><p class="font-semibold">${s.q}</p><div class="flex flex-wrap gap-2 mt-2">${s.options.map(opt => `<button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-question="${i}" data-answer="${s.answer}">${opt}</button>`).join('')}</div></div>`).join('');
                container.querySelectorAll('.scenario-option').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const questionOptions = container.querySelectorAll(`button[data-question="${btn.dataset.question}"]`);
                        questionOptions.forEach(b => { b.classList.remove('correct', 'incorrect'); b.disabled = true; });
                        if (btn.textContent === btn.dataset.answer) { btn.classList.add('correct'); } else { btn.classList.add('incorrect'); }
                    });
                });
            }
            // --- MODULE 3 INTERACTIONS ---
            else if (activityId === 'm3_intro') {
                 document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                    document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                    btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                 }));
            } else if (activityId === 'm3_choc') {
                document.querySelectorAll('.scenario-option').forEach(btn => btn.addEventListener('click', () => {
                    const feedback = document.getElementById('choc-feedback');
                    feedback.textContent = btn.dataset.feedback;
                    feedback.classList.remove('hidden');
                }));
            } else if (activityId === 'm3_stereotypes') {
                document.getElementById('check_m3_quiz2').addEventListener('click', () => {
                    const q1 = document.querySelector('input[name="sq1"]:checked');
                    const q2 = document.querySelector('input[name="sq2"]:checked');
                    if (q1) {
                        q1.closest('.quiz-option').classList.add(q1.value === 'faux' ? 'correct' : 'incorrect');
                        q1.closest('div').nextElementSibling.classList.remove('hidden');
                    }
                     if (q2) {
                        q2.closest('.quiz-option').classList.add(q2.value === 'vrai' ? 'correct' : 'incorrect');
                        q2.closest('div').nextElementSibling.classList.remove('hidden');
                    }
                });
            } else if (activityId === 'm3_cles') {
                document.querySelectorAll('.quiz-option').forEach(label => {
                    label.addEventListener('click', () => {
                        document.querySelectorAll('.quiz-option').forEach(l => l.classList.remove('selected'));
                        label.classList.add('selected');
                    });
                });
            }
             // --- MODULE 4 INTERACTIONS ---
            else if (activityId === 'm4_intro') {
                document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                    document.getElementById('m4_flash_question_feedback').textContent = btn.dataset.feedback;
                    document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                    btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                }));
            } else if (activityId === 'm4_assurance') {
                document.getElementById('check_m4_qcm').addEventListener('click', () => {
                    const answers = { aq1: 'faux', aq2: 'vrai', aq3: 'faux' };
                    let allCorrect = true;
                    for (const qId in answers) {
                        const choice = document.querySelector(`input[name="${qId}"]:checked`);
                        if (choice) {
                            choice.closest('.quiz-option').classList.add(choice.value === answers[qId] ? 'correct' : 'incorrect');
                            if(choice.value !== answers[qId]) allCorrect = false;
                        } else {
                            allCorrect = false;
                        }
                    }
                    if (allCorrect) { setTimeout(() => renderActivity('m4_urgence'), 1000); }
                });
            } else if (activityId === 'm4_urgence') {
                const scenarios = [
                    { q: "Tu perds ton passeport.", answer: "Consulat/Ambassade" },
                    { q: "Tu as un accident de scooter.", answer: "112 + Tuteur" },
                    { q: "Tu te fais voler ton sac.", answer: "Police locale + Tuteur" },
                    { q: "Tu as un gros conflit dans ta structure.", answer: "Tuteur + Mission Locale" }
                ];
                const container = document.getElementById('scenario-container-urgence');
                container.innerHTML = scenarios.map((s, i) => `
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <p class="font-semibold">${s.q}</p>
                        <div class="flex flex-wrap gap-2 mt-2">
                            <button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="${s.answer}">112 + Tuteur</button>
                            <button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="${s.answer}">Consulat/Ambassade</button>
                            <button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="${s.answer}">Police locale + Tuteur</button>
                            <button class="scenario-option text-sm bg-white border border-gray-300 px-3 py-1 rounded-full hover:bg-gray-200" data-answer="${s.answer}">Tuteur + Mission Locale</button>
                        </div>
                    </div>`).join('');
                container.querySelectorAll('.scenario-option').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const questionOptions = btn.parentElement.querySelectorAll('button');
                        questionOptions.forEach(b => { b.classList.remove('correct', 'incorrect'); b.disabled = true; });
                        if (btn.textContent === btn.dataset.answer) { btn.classList.add('correct'); } else { btn.classList.add('incorrect'); }
                    });
                });
            }
             // --- MODULE 5 INTERACTIONS ---
            else if (activityId === 'm5_intro') {
                document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                    document.getElementById('m5_flash_question_feedback').textContent = btn.dataset.feedback;
                    document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                    btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                }));
            } else if (activityId === 'm5_cej') {
                document.getElementById('check_m5_cej').addEventListener('click', () => {
                    const choice = document.querySelector('input[name="cej_q"]:checked');
                    if (choice) {
                        document.querySelectorAll('.quiz-option').forEach(l => l.classList.remove('correct', 'incorrect'));
                        choice.closest('.quiz-option').classList.add(choice.value === 'correct' ? 'correct' : 'incorrect');
                        if (choice.value === 'correct') { setTimeout(() => renderActivity('m5_assurance_docs'), 1000); }
                    }
                });
            } else if (activityId === 'm5_assurance_docs') {
                 document.getElementById('check_m5_assurance').addEventListener('click', () => {
                    const answers = { as1: 'faux', as2: 'vrai' };
                    let allCorrect = true;
                    for (const qId in answers) {
                        const choice = document.querySelector(`input[name="${qId}"]:checked`);
                        if (choice) {
                            choice.closest('.quiz-option').classList.add(choice.value === answers[qId] ? 'correct' : 'incorrect');
                            if(choice.value !== answers[qId]) allCorrect = false;
                        } else {
                            allCorrect = false;
                        }
                    }
                    if (allCorrect) { setTimeout(hideModal, 1000); }
                });
            }
            // --- MODULE 6 INTERACTIONS ---
            else if (activityId === 'm6_intro') {
                document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                    document.getElementById('m6_flash_question_feedback').textContent = btn.dataset.feedback;
                    document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                    btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                }));
            } else if (activityId === 'm6_defi') {
                const phrases = [
                    { fr: "Bonjour", en: "Hello" },
                    { fr: "Merci", en: "Thank you" },
                    { fr: "Je ne comprends pas", en: "I don’t understand" },
                    { fr: "Où est... ?", en: "Where is... ?" },
                    { fr: "Combien ça coûte ?", en: "How much is it?" }
                ];
                const container = document.getElementById('m6_defi_container');
                container.innerHTML = phrases.map((p, i) => `
                    <div class="grid grid-cols-2 gap-4 items-center">
                        <div class="p-2 bg-gray-100 rounded text-center font-semibold">${p.fr}</div>
                        <div>
                            <select id="select_en_${i}" class="w-full p-2 border border-gray-300 rounded-md">
                                <option value="">Choisir...</option>
                                ${phrases.sort(() => 0.5 - Math.random()).map(opt => `<option value="${opt.en}">${opt.en}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                `).join('');
                document.getElementById('check_m6_defi').addEventListener('click', () => {
                    let allCorrect = true;
                    phrases.forEach((p, i) => {
                        const select = document.getElementById(`select_en_${i}`);
                        select.classList.remove('correct', 'incorrect');
                        if (select.value === p.en) {
                            select.classList.add('correct');
                        } else {
                            select.classList.add('incorrect');
                            allCorrect = false;
                        }
                    });
                    if (allCorrect) { setTimeout(() => renderActivity('m6_cles'), 1000); }
                });
            }
            // --- MODULE 7 INTERACTIONS ---
            else if (activityId.startsWith('m7_')) {
                if (activityId === 'm7_intro') {
                    document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                        document.getElementById('m7_flash_question_feedback').textContent = btn.dataset.feedback;
                        document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                        btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                    }));
                } else if (activityId === 'm7_valise') {
                    const draggables = document.querySelectorAll('.draggable');
                    const dropZones = document.querySelectorAll('.drop-zone');
                    let draggedItem = null;
                    draggables.forEach(draggable => {
                        draggable.addEventListener('dragstart', () => { draggedItem = draggable; setTimeout(() => draggable.style.display = 'none', 0); });
                        draggable.addEventListener('dragend', () => { setTimeout(() => { draggedItem.style.display = 'block'; draggedItem = null; }, 0); });
                    });
                    dropZones.forEach(zone => {
                        zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
                        zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
                        zone.addEventListener('drop', () => {
                            zone.classList.remove('drag-over');
                            if (draggedItem && zone.dataset.zone === draggedItem.dataset.target) {
                                zone.appendChild(draggedItem);
                                draggedItem.setAttribute('draggable', 'false');
                            }
                        });
                    });
                } else if (activityId === 'm7_guide') {
                    document.getElementById('check_m7_guide').addEventListener('click', () => {
                        const answers = { gq1: 'vrai', gq2: 'vrai' };
                        let allCorrect = true;
                        for (const qId in answers) {
                            const choice = document.querySelector(`input[name="${qId}"]:checked`);
                            if (choice) {
                                choice.closest('.quiz-option').classList.add(choice.value === answers[qId] ? 'correct' : 'incorrect');
                                if(choice.value !== answers[qId]) allCorrect = false;
                            } else {
                                allCorrect = false;
                            }
                        }
                        if (allCorrect) { setTimeout(() => renderActivity('m7_green_bonus'), 1000); }
                    });
                } else if (activityId === 'm7_green_bonus') {
                    const gameContainer = document.getElementById('m7_bonus_game');
                    const answers = { "Avion": "non", "Train": "oui", "Covoiturage": "oui", "Bus": "oui" };
                    gameContainer.querySelectorAll('.scenario-option').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const transport = btn.parentElement.previousElementSibling.textContent;
                            const isCorrect = (answers[transport] === btn.dataset.answer);
                            const questionOptions = btn.parentElement.querySelectorAll('button');
                            questionOptions.forEach(b => { b.classList.remove('correct', 'incorrect'); b.disabled = true; });
                            btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                        });
                    });
                }
            }
            // --- MODULE 8 INTERACTIONS ---
            else if (activityId.startsWith('m8_')) {
                if (activityId === 'm8_intro') {
                    document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                        document.getElementById('m8_flash_question_feedback').textContent = btn.dataset.feedback;
                        document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                        btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                    }));
                } else if (activityId === 'm8_astuces') {
                    document.querySelectorAll('.astuce-btn').forEach(btn => btn.addEventListener('click', () => {
                        document.getElementById('astuce-feedback').textContent = btn.dataset.feedback;
                    }));
                }
            }
            // --- MODULE 9 INTERACTIONS ---
            else if (activityId.startsWith('m9_')) {
                if (activityId === 'm9_intro') {
                    document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                        document.getElementById('m9_flash_question_feedback').textContent = btn.dataset.feedback;
                        document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                        btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                    }));
                } else if (activityId === 'm9_calculateur') {
                    document.getElementById('calcul_budget_btn').addEventListener('click', () => {
                        const revenus = ['revenu_cej', 'revenu_bourse', 'revenu_autre'].reduce((acc, id) => acc + (parseFloat(document.getElementById(id).value) || 0), 0);
                        const depenses = ['depense_loyer', 'depense_nourriture', 'depense_transport', 'depense_loisirs'].reduce((acc, id) => acc + (parseFloat(document.getElementById(id).value) || 0), 0);
                        const solde = revenus - depenses;
                        
                        const resultDiv = document.getElementById('budget_result');
                        const soldeValue = document.getElementById('solde_value');
                        const soldeFeedback = document.getElementById('solde_feedback');

                        soldeValue.textContent = solde.toFixed(2);
                        if (solde > 0) {
                            soldeFeedback.textContent = "✅ Super ! Ton budget est en excédent.";
                            soldeFeedback.className = "mt-2 font-semibold text-green-600";
                        } else if (solde === 0) {
                             soldeFeedback.textContent = "👌 Ton budget est à l'équilibre. Attention aux imprévus !";
                             soldeFeedback.className = "mt-2 font-semibold text-yellow-600";
                        } else {
                            soldeFeedback.textContent = "⚠️ Attention, ton budget est en déficit. Il faut revoir tes dépenses.";
                            soldeFeedback.className = "mt-2 font-semibold text-red-600";
                        }
                        resultDiv.classList.remove('hidden');
                    });
                } else if (activityId === 'm9_tri') {
                    const draggables = document.querySelectorAll('.draggable');
                    const dropZones = document.querySelectorAll('.drop-zone');
                    let draggedItem = null;
                    draggables.forEach(draggable => {
                        draggable.addEventListener('dragstart', () => { draggedItem = draggable; setTimeout(() => draggable.style.display = 'none', 0); });
                        draggable.addEventListener('dragend', () => { setTimeout(() => { draggedItem.style.display = 'block'; draggedItem = null; }, 0); });
                    });
                    dropZones.forEach(zone => {
                        zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
                        zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
                        zone.addEventListener('drop', () => {
                            zone.classList.remove('drag-over');
                            if (draggedItem && zone.dataset.zone === draggedItem.dataset.target) {
                                zone.appendChild(draggedItem);
                                draggedItem.setAttribute('draggable', 'false');
                            }
                        });
                    });
                }
            }
             // --- MODULE 10 INTERACTIONS ---
            else if (activityId.startsWith('m10_')) {
                if (activityId === 'm10_intro') {
                    document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                        document.getElementById('m10_flash_question_feedback').textContent = btn.dataset.feedback;
                        document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                        btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                    }));
                } else if (activityId === 'm10_conflits') {
                    document.getElementById('check_m10_conflit').addEventListener('click', () => {
                        const choice = document.querySelector('input[name="conflit_q"]:checked');
                        if (choice) {
                            document.querySelectorAll('.quiz-option').forEach(l => l.classList.remove('correct', 'incorrect'));
                            choice.closest('.quiz-option').classList.add(choice.value === 'correct' ? 'correct' : 'incorrect');
                            if (choice.value === 'correct') { setTimeout(() => renderActivity('m10_quiz_coloc'), 1000); }
                        }
                    });
                } else if (activityId === 'm10_quiz_coloc') {
                    document.getElementById('check_m10_qcm_coloc').addEventListener('click', () => {
                        const score1 = parseInt(document.querySelector('input[name="cq1"]:checked')?.value || 0);
                        const score2 = parseInt(document.querySelector('input[name="cq2"]:checked')?.value || 0);
                        const totalScore = score1 + score2;
                        let profile = '';
                        if (totalScore >= 3) {
                            profile = 'Coloc responsable';
                        } else if (totalScore >= 1) {
                            profile = 'Coloc à améliorer';
                        } else {
                            profile = 'Coloc fantôme';
                        }
                        const container = document.getElementById('m10_qcm_coloc');
                        container.innerHTML = `<div class="text-center p-4"><h4 class="text-xl font-bold">Ton profil : ${profile} !</h4><p class="mt-2 text-gray-600">N'oublie pas que la communication et le respect sont les clés d'une bonne colocation.</p><button onclick="hideModal()" class="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700">Terminer</button></div>`;
                    });
                }
            }
            // --- MODULE 11 INTERACTIONS ---
            else if (activityId.startsWith('m11_')) {
                if (activityId === 'm11_intro') {
                    document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                        document.getElementById('m11_flash_question_feedback').textContent = btn.dataset.feedback;
                        document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                        btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                    }));
                } else if (activityId === 'm11_quiz_valeurs') {
                    document.getElementById('check_m11_valeurs').addEventListener('click', () => {
                        const vq1 = document.querySelector('input[name="vq1"]:checked')?.value;
                        const vq2 = document.querySelector('input[name="vq2"]:checked')?.value;
                        if (!vq1 || !vq2) return;
                        
                        const values = { solidarite: 0, responsabilite: 0, ouverture: 0 };
                        values[vq1]++;
                        values[vq2]++;

                        const sortedValues = Object.entries(values).sort((a,b) => b[1] - a[1]);
                        const mainValue = sortedValues[0][0];

                        const container = document.getElementById('m11_valeurs_qcm');
                        container.innerHTML = `<div class="text-center p-4"><h4 class="text-xl font-bold">Ta valeur motrice principale est : <span class="capitalize text-blue-600">${mainValue}</span> !</h4><p class="mt-2 text-gray-600">C'est une force qui guidera ton engagement à l'étranger.</p><button onclick="renderActivity('m11_journal')" class="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700">Continuer</button></div>`;
                    });
                }
            }
            // --- MODULE 12 INTERACTIONS ---
            else if (activityId.startsWith('m12_')) {
                if (activityId === 'm12_intro') {
                    document.querySelectorAll('.sondage-option').forEach(btn => btn.addEventListener('click', () => {
                        document.getElementById('m12_flash_question_feedback').textContent = btn.dataset.feedback;
                        document.querySelectorAll('.sondage-option').forEach(b => b.classList.remove('selected', 'bg-blue-600', 'text-white', 'border-blue-600'));
                        btn.classList.add('selected', 'bg-blue-600', 'text-white', 'border-blue-600');
                    }));
                } else if (activityId === 'm12_carte_soutien') {
                    const addBtn = document.getElementById('add-contact-btn');
                    const input = document.getElementById('new-contact-name');
                    const itemsContainer = document.getElementById('draggable-items');
                    
                    const addContact = () => {
                        const name = input.value.trim();
                        if (name) {
                            const newContact = document.createElement('div');
                            newContact.className = 'p-2 bg-white rounded shadow draggable';
                            newContact.draggable = true;
                            newContact.textContent = name;
                            itemsContainer.appendChild(newContact);
                            input.value = '';
                            addDragEvents(newContact); // Add events to the new element
                        }
                    };
                    addBtn.addEventListener('click', addContact);
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') addContact();
                    });

                    let draggedItem = null;
                    function addDragEvents(draggable) {
                        draggable.addEventListener('dragstart', () => { draggedItem = draggable; setTimeout(() => draggable.style.display = 'none', 0); });
                        draggable.addEventListener('dragend', () => { setTimeout(() => { if(draggedItem) { draggedItem.style.display = 'block'; } draggedItem = null; }, 0); });
                    }
                    document.querySelectorAll('.drop-zone').forEach(zone => {
                        zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
                        zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
                        zone.addEventListener('drop', () => {
                            zone.classList.remove('drag-over');
                            if (draggedItem) { zone.appendChild(draggedItem); }
                        });
                    });
                } else if (activityId === 'm12_amis') {
                    document.getElementById('check_m12_amis').addEventListener('click', () => {
                        const choice = document.querySelector('input[name="amis_q"]:checked');
                        if (choice) {
                            document.querySelectorAll('.quiz-option').forEach(l => l.classList.remove('correct', 'incorrect'));
                            choice.closest('.quiz-option').classList.add(choice.value === 'correct' ? 'correct' : 'incorrect');
                            if (choice.value === 'correct') { setTimeout(() => renderActivity('m12_cles'), 1000); }
                        }
                    });
                }
            }
             // --- MODULE 13 INTERACTIONS ---
            else if (activityId === 'm13_cv_valorisation') {
                const checklist = document.getElementById('m13_cv_checklist');
                const list = document.getElementById('cv-skills-list');
                checklist.addEventListener('change', () => {
                    list.innerHTML = '';
                    const checkedSkills = checklist.querySelectorAll('input:checked');
                    if (checkedSkills.length === 0) {
                        list.innerHTML = '<li>Coche une compétence pour la voir apparaître ici.</li>';
                    } else {
                        checkedSkills.forEach(checkbox => {
                            const li = document.createElement('li');
                            li.textContent = checkbox.dataset.skill;
                            list.appendChild(li);
                        });
                    }
                });
                // Initial check
                list.innerHTML = '<li>Coche une compétence pour la voir apparaître ici.</li>';
            }
        }

        function handleQuizSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            let scores = { stage: 0, volontariat: 0, echange: 0 };
            for (let i = 0; i < quizQuestions.length; i++) {
                const answerIndex = formData.get(`q${i}`);
                if (answerIndex !== null) {
                    const points = quizQuestions[i].answers[answerIndex].points;
                    for (const key in points) { scores[key] = (scores[key] || 0) + points[key]; }
                }
            }
            renderActivity('m1_quiz_results', scores);
        }

        // --- Initial Page Build ---
        modulesData.forEach(module => {
            const card = document.createElement('div');
            card.className = 'module-card';
            card.dataset.id = module.id;
            let activitiesHTML = module.activities.map(activity => `<div class="activity-item" data-activity-id="${activity.id}"><i data-lucide="${activity.icon}" class="w-5 h-5"></i><div><p class="font-semibold text-gray-700">${activity.title}</p><p class="text-sm text-gray-500">${activity.type}</p></div></div>`).join('');
            card.innerHTML = `<div class="module-header" data-module-id="${module.id}"><div class="module-icon" style="background-color: ${module.color}; color: ${module.iconColor};"><i data-lucide="${module.icon}" class="w-8 h-8"></i></div><div><h3 class="text-xl font-bold text-gray-900">${module.title}</h3><span class="module-tag ${module.tag.class}">${module.tag.text}</span></div></div><div class="module-content">${activitiesHTML}<button class="mark-complete-btn mt-4 w-full text-white font-semibold py-2 px-4 rounded-lg bg-blue-600 hover:bg-blue-700 transition-colors" data-module-id="${module.id}">Marquer comme terminé</button></div>`;
            grid.appendChild(card);
        });
        lucide.createIcons();

        // --- Event Listeners ---
        grid.addEventListener('click', function(e) {
            const activityItem = e.target.closest('.activity-item');
            if (activityItem) { renderActivity(activityItem.dataset.activityId); return; }

            const completeBtn = e.target.closest('.mark-complete-btn');
            if (completeBtn) {
                const moduleId = parseInt(completeBtn.dataset.moduleId);
                completedModules.add(moduleId);
                localStorage.setItem('completedModules', JSON.stringify([...completedModules]));
                updateProgress();
                const card = completeBtn.closest('.module-card');
                if (card) { card.querySelector('.module-content').style.display = 'none'; }
                return;
            }

            const header = e.target.closest('.module-header');
            if (header) {
                const card = header.closest('.module-card');
                const content = card.querySelector('.module-content');
                const wasVisible = content.style.display === 'block';
                document.querySelectorAll('.module-content').forEach(c => { c.style.display = 'none'; });
                if (!wasVisible) { content.style.display = 'block'; }
            }
        });
        
        modal.addEventListener('click', (e) => { if (e.target === modal) { hideModal(); } });
        
        updateProgress();
    });
    </script>
</body>
</html>
